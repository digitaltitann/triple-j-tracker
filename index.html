<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triple J Bet Tracker</title>
    <link rel="stylesheet" href="styles.css?v=16">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="triple j.jpg">
</head>
<body>
    <div class="container">
        <header>
            <h1>Triple J Bet Tracker <span class="aka">(AKA Jun)</span></h1>
        </header>

        <!-- Simple Input -->
        <section class="input-section">
            <div class="input-wrapper">
                <div class="crew-photo">
                    <img src="triple%20j.jpg" alt="Triple J Crew">
                </div>
                <div class="input-container">
                    <textarea
                        id="stats-input"
                        placeholder="Type what you want to track, e.g.:&#10;lebron 25+ points, mahomes 300+ passing yards&#10;Chiefs ML, Lakers -5.5, Over 45.5 Chiefs Lions"
                        rows="5"
                    ></textarea>
                    <div class="input-buttons">
                        <button id="track-btn" class="btn-track">Track Stats</button>
                        <label id="upload-btn" class="btn-upload" title="Upload bet slip image">
                            <input type="file" id="image-input" accept="image/*" hidden>
                            <span class="upload-icon">ðŸ“·</span>
                        </label>
                    </div>
                    <div id="ocr-status" class="ocr-status hidden"></div>
                </div>
                <div class="crew-photo">
                    <img src="triple%20j.jpg" alt="Triple J Crew">
                </div>
            </div>
            <p class="input-hint">Player props: "lebron 25+ points" | Team bets: "Chiefs ML", "Lakers -5.5" | Or tap ðŸ“· to upload a bet slip</p>
        </section>

        <!-- Live Stats Cards -->
        <section class="stats-section">
            <div class="section-header">
                <h2>Live Tracking</h2>
                <div class="header-actions">
                    <button class="btn-view-toggle" onclick="toggleView()" title="Toggle view">
                        <span id="view-icon">â˜°</span>
                    </button>
                    <button class="btn-refresh" onclick="refreshAllStats()">
                        <span class="refresh-icon">â†»</span> Refresh
                    </button>
                    <button class="btn-clear" onclick="clearAll()">Clear All</button>
                </div>
            </div>
            <div id="stats-container" class="stats-grid">
                <div class="empty-state">
                    <p>No stats being tracked yet.</p>
                    <p class="hint">Type some player props above to get started!</p>
                </div>
            </div>
        </section>
    </div>

    <script src="parser.js?v=16"></script>
    <script src="api.js?v=16"></script>
    <script src="script.js?v=16"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').then((registration) => {
                // Check for updates periodically
                setInterval(() => registration.update(), 60000);

                // Listen for new service worker
                registration.addEventListener('updatefound', () => {
                    const newWorker = registration.installing;
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            // New version available - show update banner
                            showUpdateBanner();
                        }
                    });
                });
            });

            // Reload when new service worker takes over
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    refreshing = true;
                    window.location.reload();
                }
            });
        }

        function showUpdateBanner() {
            const banner = document.createElement('div');
            banner.id = 'update-banner';
            banner.innerHTML = `
                <span>New version available!</span>
                <button onclick="updateApp()">Update Now</button>
            `;
            document.body.appendChild(banner);
        }

        function updateApp() {
            navigator.serviceWorker.getRegistration().then((reg) => {
                if (reg && reg.waiting) {
                    reg.waiting.postMessage({ type: 'SKIP_WAITING' });
                }
            });
        }
    </script>
</body>
</html>
